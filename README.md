#Tiraggo.EF#
##The Tiraggo Dynamic Query API for the Entity Framework##

By: Mike Griffin (http://www.tiraggo.com)

License: [MIT](http://www.opensource.org/licenses/mit-license.php)

##Tired of LINQ and Lamba?##
Tired of writing complex, unintuitive Linq and Lambda expressions? Why not tap into your knowledge of writing SQL queries. Now you can have the best of both worlds, the Tiraggo Dynamic Query API and your Entity Framework entities.

##Intuitive and Familiar SQL API##
Full Intellisense Support
```csharp

EmployeeQuery q = new EmployeeQuery("e");
EmployeeQuery q1 = new EmployeeQuery("e1");

q.Select(q.EmployeeID, q.LastName)  // To bind to combobox
	.Where(q.LastName.Like("%a%"))
	.InnerJoin(q1).On(q.EmployeeID == q1.ReportsTo)
	.OrderBy(q.LastName.Descending);

using(NorthwindEntities context = new NorthwindEntities())
{
	IList<Employee> employees = q.ToList<Employee>(context);
}
```

Yep, you can actually only select the columns you desire and the SQL is extremely lean. Requires a single .NET assembly. NuGet package on the way ...

```sql

SELECT
   e.[EmployeeID],
   e.[LastName]  
FROM
   [Employees] e 
INNER JOIN [Employees] e1 
   ON e.[EmployeeID] = e1.[ReportsTo] 
WHERE
   e.[LastName] LIKE @LastName1 
ORDER BY
   e.[LastName] DESC
```

Compare that SQL to the SQL generated by a Entity Framework query which does the same thing and you'll be shocked.

##More Samples##

### Case When Then Else ###
```csharp
OrderItemQuery oq = new OrderItemQuery();

oq.Select
(
    oq.UnitPrice
        .Case()
            .When(oq.Quantity < 50).Then(oq.UnitPrice)
            .When(oq.Quantity >= 50 && oq.Quantity < 70).Then(oq.UnitPrice * .90)
            .When(oq.Quantity >= 70 && oq.Quantity < 99).Then(oq.UnitPrice * .80)
            .Else(oq.UnitPrice * .70)
        .End()
);

using(NorthwindEntities context = new NorthwindEntities())
{
	IList<OrderItem> items = oq.ToList<OrderItem>(context);
}
```

### Another Case When Then Else ###
```csharp
EmployeeQuery q = new EmployeeQuery();

q.Select
(
    q.LastName
        .Case()
            .When(q.LastName.Like("%a%")).Then("Last Name Contains an A")
            .Else("Last Name Doesnt Contain an A")
        .End().As("SpecialLastName")
);

using(NorthwindEntities context = new NorthwindEntities())
{
	IList<Employee> employees = q.ToList<Employee>(context);
}
```

###SelectAllExcept###
SelectAllExcept() is not really a SubQuery, just a convenient enhancement that allows you to select all except one or more listed columns.
```csharp
EmployeeQuery q = new EmployeeQuery()
q.SelectAllExcept(q.Photo); // We don't want the image

using(NorthwindEntities context = new NorthwindEntities())
{
	IList<Employee> employees = q.ToList<Employee>(context);
}
```

Results:
```sql
SELECT [LastName],[Supervisor],[Age]  
FROM [ForeignKeyTest].[dbo].[Employee]
```

###Select SubQuery###
A SubQuery in a Select clause must return a single value.
```csharp
OrderQuery orders = new OrderQuery("o");
OrderItemQuery details = new OrderItemQuery("oi");

orders.Select
(
    orders.OrderID,
    orders.OrderDate,
    details.Select(
        details.UnitPrice.Max())
        .Where(orders.OrderID == details.OrderID).As("MaxUnitPrice")
);

using(NorthwindEntities context = new NorthwindEntities())
{
	IList<Order> employees = orders.ToList<Order>(context);
}
```

Results:
```sql
SELECT o.[OrderID],o.[OrderDate], 
    (SELECT MAX(oi.[UnitPrice]) AS 'UnitPrice'  
    FROM [ForeignKeyTest].[dbo].[OrderItem] oi 
    WHERE o.[OrderID] = oi.[OrderID]) AS MaxUnitPrice  
FROM [ForeignKeyTest].[dbo].[Order] o
```

This is the same as the query above, but returns all columns in the Order table, instead of just OrderID and OrderDate. Notice that the Select clause contains orders, not orders.*. The SQL produced will use the supplied alias o.*.

```csharp
OrderQuery orders = new OrderQuery("o");
OrderItemQuery details = new OrderItemQuery("oi");

orders.Select
(
    orders,
    details.Select(
        details.UnitPrice.Max())
        .Where(orders.OrderID == details.OrderID).As("MaxUnitPrice")
);

using(NorthwindEntities context = new NorthwindEntities())
{
	IList<Order> orders = orders.ToList<Order>(context);
}
```

Results:
```sql
SELECT o.*, 
    (SELECT MAX(oi.[UnitPrice]) AS 'UnitPrice'  
    FROM [ForeignKeyTest].[dbo].[OrderItem] oi 
    WHERE o.[OrderID] = oi.[OrderID]) AS MaxUnitPrice  
FROM [ForeignKeyTest].[dbo].[Order] o
```
